---
title: "MATH2404 Assignment 3: Storytelling with open data"
author: "Jolie Phuong PHAM - s3939107"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width = 14, fig.height = 8) 
```

# Load packages
```{r}
library(readr)
library(tidyverse)
library(ggplot2)
library(ggrepel)
library(plotly)
library(magrittr)
library(here)
library(stringr)
library(maps)
library(viridis)
library(hrbrthemes)
library(countrycode)
```



# Load dataset
```{r}
holiday <- read_csv(here("holiday_calendar.csv"))
head(holiday)

```
### CHART 1: Number of holidays per country

```{r}
holidays_per_country <- holiday %>%
  # capitalise
  mutate(Country = str_to_title(holiday$Country)) %>%
  # replace dash with space and lowercase And
  mutate(Country = str_replace_all(Country, c("-" = " ", 
                                              "And" = "and"))) %>%
  # count holidays by country
  group_by(Country) %>%
  filter(Type %in% c("National Holiday", "Federal Holiday", "Public Holiday", "Government Holiday", "Bank Holiday", "NA")) %>%
  summarise(Count = n())

# load map data for background
mapdata <- map_data("world") %>% 
  rename(country = region)

# load world cities data to locate the bubbles
cities <- world.cities %>% 
  filter(capital == 1) %>%
  rename(Country = country.etc)

# check on the country names mismatches
mismatch_1 <- anti_join(holidays_per_country, cities, by = "Country")
mismatch_2 <- anti_join(cities, holidays_per_country, by = "Country")

# recode to match names
holidays_per_country$Country <- recode(holidays_per_country$Country,
                                       "andorra" = "Andorra",
                                       "Bonaire St Eustatius Saba" = "Netherlands Antilles",
                                       "Congo" = "Congo Democratic Republic",
                                       "Guernsey" = "Guernsey and Alderney",
                                       "Isle Of Man" = "Isle Of Man",
                                       "Lao" = "Laos",
                                       "South Korea" = "Korea South",
                                       "United Kingdom" = "UK",
                                       "Usa" = "USA")

# get 10 countries with the most holidays
holidays_per_country %>%
  slice_max(n = 10, order_by = Count) %>%
  select(Country)

# convert to list
top_10 <- c("Macau", "Myanmar", "Thailand", "China", "Sri Lanka", "Azerbaijan", "Bangladesh", "Lebanon", "Nepal", "Argentina" )

```

```{r}
# joining 2 tables
holidays_map <- left_join(holidays_per_country, cities, by = "Country") %>%
  mutate(Continent = countrycode(sourcevar = Country,
                            origin = "country.name",
                            destination = "continent"))

  
# reorder and add text for plotly
holidays_map <- holidays_map %>% 
  drop_na() %>%
  arrange(Count) %>%
  mutate(name = factor(Country, unique(Count))) %>%
  mutate(mytext = paste(
    "Country: ", Country, "\n", 
    "Number of Holidays: ", Count, sep="")) %>%
  mutate(label = case_when(Country %in% top_10 ~ Country,
                           TRUE ~ ""))
```

```{r}
#visualisation
p <- ggplot() +
  geom_polygon(data = mapdata, aes(x = long, y = lat, group = group), fill = "grey", alpha = 0.5) +
  geom_point(data = holidays_map, aes(x = long, y = lat, size = Count, color = Count, text = mytext), alpha = 0.5) +
  labs(title = "Number of Public Holidays in Each Country") +
  scale_colour_viridis(option = "D") +
  theme_minimal() +
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) +
  geom_text(data = holidays_map, aes(x = long, y = lat, label = label), 
            color = "dodgerblue4", size = 3, fontface = "bold")

# adding the country name for the top 10

p <- ggplotly(p, tooltip = c("text", "label"))
p
```

### Which month has the most holidays
```{r}

```



"Not a public holiday" are mostly Mother's and Father's days, which usually aren't public holidays, so I'm going to filter them out

"Regional Holidays" only apply to a specific region in a country. I decided to filter them out too, as they are not applicable to whole countries and it would be too much work to split every country by region.














































